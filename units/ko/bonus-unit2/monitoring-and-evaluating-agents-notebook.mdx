<CourseFloatingBanner chapter={2}
  classNames="absolute z-10 right-0 top-0"
  notebooks={[
    {label: "Google Colab", value: "https://colab.research.google.com/#fileId=https%3A//huggingface.co/agents-course/notebooks/blob/main/bonus-unit2/monitoring-and-evaluating-agents.ipynb"},
]} />

# ë³´ë„ˆìŠ¤ ìœ ë‹› 2: ì—ì´ì „íŠ¸ ê´€ì¸¡ì„±ê³¼ í‰ê°€

<Tip>
ì½”ë“œëŠ” <a href="https://colab.research.google.com/#fileId=https%3A//huggingface.co/agents-course/notebooks/blob/main/bonus-unit2/monitoring-and-evaluating-agents.ipynb" target="_blank">ì´ ë…¸íŠ¸ë¶</a>ì—ì„œ Google Colabìœ¼ë¡œ ì§ì ‘ ì‹¤í–‰í•˜ë©° ë”°ë¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
</Tip>

ì´ ë…¸íŠ¸ë¶ì—ì„œëŠ” **AI ì—ì´ì „íŠ¸ì˜ ë‚´ë¶€ ë‹¨ê³„(íŠ¸ë ˆì´ìŠ¤)ë¥¼ ëª¨ë‹ˆí„°ë§**í•˜ê³  **ì˜¤í”ˆì†ŒìŠ¤ ê´€ì¸¡ì„± ë„êµ¬ë¡œ ì„±ëŠ¥ì„ í‰ê°€**í•˜ëŠ” ë°©ë²•ì„ ë°°ì›ë‹ˆë‹¤.

ì—ì´ì „íŠ¸ì˜ í–‰ë™ì„ ê´€ì°°Â·í‰ê°€í•˜ëŠ” ëŠ¥ë ¥ì€ ë‹¤ìŒì— í•„ìˆ˜ì ì…ë‹ˆë‹¤:
- ì‘ì—… ì‹¤íŒ¨ë‚˜ ê²°ê³¼ê°€ ë¯¸í¡í•  ë•Œ ë””ë²„ê¹…
- ì‹¤ì‹œê°„ ë¹„ìš© ë° ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§
- ì§€ì†ì  í”¼ë“œë°±ì„ í†µí•œ ì‹ ë¢°ì„±Â·ì•ˆì „ì„± í–¥ìƒ

## ì‹¤ìŠµ ì „ì œ ì¡°ê±´ ğŸ—ï¸

ì´ ë…¸íŠ¸ë¶ì„ ì‹¤í–‰í•˜ê¸° ì „ì— ë‹¤ìŒì„ ë°˜ë“œì‹œ í•™ìŠµí•˜ì„¸ìš”:

ğŸ”² ğŸ“š  [ì—ì´ì „íŠ¸ ì†Œê°œ](https://huggingface.co/learn/agents-course/unit1/introduction) í•™ìŠµ

ğŸ”² ğŸ“š  [smolagents í”„ë ˆì„ì›Œí¬](https://huggingface.co/learn/agents-course/unit2/smolagents/introduction) í•™ìŠµ

## Step 0: í•„ìˆ˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜

ì—ì´ì „íŠ¸ ì‹¤í–‰, ëª¨ë‹ˆí„°ë§, í‰ê°€ë¥¼ ìœ„í•´ ë‹¤ìŒ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ í•„ìš”í•©ë‹ˆë‹¤:

```python
%pip install 'smolagents[telemetry]'
%pip install opentelemetry-sdk opentelemetry-exporter-otlp openinference-instrumentation-smolagents
%pip install langfuse datasets 'smolagents[gradio]'
```

## Step 1: ì—ì´ì „íŠ¸ ê³„ì¸¡(Instrumentation)

ì´ ë…¸íŠ¸ë¶ì—ì„œëŠ” [Langfuse](https://langfuse.com/)ë¥¼ ê´€ì¸¡ì„± ë„êµ¬ë¡œ ì‚¬ìš©í•˜ì§€ë§Œ, **ë‹¤ë¥¸ OpenTelemetry í˜¸í™˜ ì„œë¹„ìŠ¤ë„ ì‚¬ìš© ê°€ëŠ¥**í•©ë‹ˆë‹¤. ì•„ë˜ ì½”ë“œëŠ” Langfuse(ë˜ëŠ” OTel ì—”ë“œí¬ì¸íŠ¸) ì—°ê²°ì„ ìœ„í•œ í™˜ê²½ ë³€ìˆ˜ ì„¤ì •ê³¼ smolagent ê³„ì¸¡ ë°©ë²•ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.

**ì°¸ê³ :** LlamaIndexë‚˜ LangGraphë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš° [ì—¬ê¸°](https://langfuse.com/docs/integrations/llama-index/workflows), [ì—¬ê¸°](https://langfuse.com/docs/integrations/langchain/example-python-langgraph)ì—ì„œ ê³„ì¸¡ ë¬¸ì„œë¥¼ í™•ì¸í•˜ì„¸ìš”.

ë¨¼ì €, Langfuse OpenTelemetry ì—”ë“œí¬ì¸íŠ¸ ì—°ê²°ì„ ìœ„í•œ í™˜ê²½ ë³€ìˆ˜ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.

```python
import os
import base64

# https://cloud.langfuse.com ì—ì„œ ë³¸ì¸ í‚¤ë¥¼ ë°œê¸‰ë°›ìœ¼ì„¸ìš”
LANGFUSE_PUBLIC_KEY = "pk-lf-..." 
LANGFUSE_SECRET_KEY = "sk-lf-..." 
os.environ["LANGFUSE_PUBLIC_KEY"] = LANGFUSE_PUBLIC_KEY
os.environ["LANGFUSE_SECRET_KEY"] = LANGFUSE_SECRET_KEY
os.environ["LANGFUSE_HOST"] = "https://cloud.langfuse.com"  # ğŸ‡ªğŸ‡º EU ë¦¬ì „ ì˜ˆì‹œ
# os.environ["LANGFUSE_HOST"] = "https://us.cloud.langfuse.com"  # ğŸ‡ºğŸ‡¸ US ë¦¬ì „ ì˜ˆì‹œ

LANGFUSE_AUTH = base64.b64encode(
    f"{LANGFUSE_PUBLIC_KEY}:{LANGFUSE_SECRET_KEY}".encode()
).decode()

os.environ["OTEL_EXPORTER_OTLP_ENDPOINT"] = os.environ.get("LANGFUSE_HOST") + "/api/public/otel"
os.environ["OTEL_EXPORTER_OTLP_HEADERS"] = f"Authorization=Basic {LANGFUSE_AUTH}"
```
Hugging Face í† í°ë„ í™˜ê²½ ë³€ìˆ˜ë¡œ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤.

```python
# Hugging Face ë° ê¸°íƒ€ í† í°/ì‹œí¬ë¦¿ì„ í™˜ê²½ ë³€ìˆ˜ë¡œ ì„¤ì •
os.environ["HF_TOKEN"] = "hf_..." 
```
ë‹¤ìŒìœ¼ë¡œ, OpenTelemetryìš© tracer-providerë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.

```python
from opentelemetry.sdk.trace import TracerProvider
from openinference.instrumentation.smolagents import SmolagentsInstrumentor
from opentelemetry.exporter.otlp.proto.http.trace_exporter import OTLPSpanExporter
from opentelemetry.sdk.trace.export import SimpleSpanProcessor
 
# OpenTelemetryìš© TracerProvider ìƒì„±
trace_provider = TracerProvider()

# OTLPSpanExporterê°€ í¬í•¨ëœ SimpleSpanProcessor ì¶”ê°€(íŠ¸ë ˆì´ìŠ¤ ì „ì†¡)
trace_provider.add_span_processor(SimpleSpanProcessor(OTLPSpanExporter()))

# ê¸€ë¡œë²Œ ê¸°ë³¸ tracer provider ì„¤ì •
from opentelemetry import trace
trace.set_tracer_provider(trace_provider)
tracer = trace.get_tracer(__name__)

# smolagentsë¥¼ ê³„ì¸¡
SmolagentsInstrumentor().instrument(tracer_provider=trace_provider)
```

## Step 2: ê³„ì¸¡ í…ŒìŠ¤íŠ¸

ì•„ë˜ëŠ” smolagentsì˜ CodeAgentë¡œ `1+1`ì„ ê³„ì‚°í•˜ëŠ” ì˜ˆì‹œì…ë‹ˆë‹¤. ê³„ì¸¡ì´ ì •ìƒ ë™ì‘í•˜ë©´ ê´€ì¸¡ì„± ëŒ€ì‹œë³´ë“œì—ì„œ ë¡œê·¸/ìŠ¤íŒ¬ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```python
from smolagents import InferenceClientModel, CodeAgent

# ê³„ì¸¡ í…ŒìŠ¤íŠ¸ìš© ê°„ë‹¨í•œ ì—ì´ì „íŠ¸ ìƒì„±
agent = CodeAgent(
    tools=[],
    model=InferenceClientModel()
)

agent.run("1+1=")
```

[Langfuse Traces Dashboard](https://cloud.langfuse.com) (ë˜ëŠ” ì„ íƒí•œ ê´€ì¸¡ì„± ë„êµ¬)ì—ì„œ ìŠ¤íŒ¬ê³¼ ë¡œê·¸ê°€ ê¸°ë¡ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.

Langfuse ì˜ˆì‹œ ìŠ¤í¬ë¦°ìƒ·:

![Example trace in Langfuse](https://huggingface.co/datasets/agents-course/course-images/resolve/main/en/bonus-unit2/first-example-trace.png)

_[íŠ¸ë ˆì´ìŠ¤ ë§í¬](https://cloud.langfuse.com/project/cloramnkj0002jz088vzn1ja4/traces/1b94d6888258e0998329cdb72a371155?timestamp=2025-03-10T11%3A59%3A41.743Z)_

## Step 3: ë” ë³µì¡í•œ ì—ì´ì „íŠ¸ ê´€ì°° ë° í‰ê°€

ê³„ì¸¡ì´ ì •ìƒ ë™ì‘í•˜ëŠ” ê²ƒì„ í™•ì¸í–ˆë‹¤ë©´, ì´ì œ ë” ë³µì¡í•œ ì¿¼ë¦¬ë¡œ í† í° ì‚¬ìš©ëŸ‰, ì§€ì—°, ë¹„ìš© ë“± ê³ ê¸‰ ì§€í‘œ ì¶”ì ì„ ì‹¤ìŠµí•´ë´…ì‹œë‹¤.

```python
from smolagents import (CodeAgent, DuckDuckGoSearchTool, InferenceClientModel)

search_tool = DuckDuckGoSearchTool()
agent = CodeAgent(tools=[search_tool], model=InferenceClientModel())

agent.run("How many Rubik's Cubes could you fit inside the Notre Dame Cathedral?")
```

### íŠ¸ë ˆì´ìŠ¤ êµ¬ì¡°

ëŒ€ë¶€ë¶„ì˜ ê´€ì¸¡ì„± ë„êµ¬ëŠ” **íŠ¸ë ˆì´ìŠ¤**ì— **ìŠ¤íŒ¬**(ì—ì´ì „íŠ¸ ë…¼ë¦¬ì˜ ê° ë‹¨ê³„)ì„ í¬í•¨í•´ ê¸°ë¡í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” ì „ì²´ ì—ì´ì „íŠ¸ ì‹¤í–‰ê³¼ í•˜ìœ„ ìŠ¤íŒ¬(ë„êµ¬ í˜¸ì¶œ, LLM í˜¸ì¶œ ë“±)ì´ íŠ¸ë ˆì´ìŠ¤ì— í¬í•¨ë©ë‹ˆë‹¤.

ê° ë‹¨ê³„ë³„ ì†Œìš” ì‹œê°„, í† í° ì‚¬ìš©ëŸ‰ ë“±ì„ ìƒì„¸íˆ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

![Trace tree in Langfuse](https://huggingface.co/datasets/agents-course/course-images/resolve/main/en/bonus-unit2/trace-tree.png)

_[íŠ¸ë ˆì´ìŠ¤ ë§í¬](https://cloud.langfuse.com/project/cloramnkj0002jz088vzn1ja4/traces/1ac33b89ffd5e75d4265b62900c348ed?timestamp=2025-03-07T13%3A45%3A09.149Z&display=preview)_

## ì˜¨ë¼ì¸ í‰ê°€

ì•ì„œ ì˜¨ë¼ì¸/ì˜¤í”„ë¼ì¸ í‰ê°€ì˜ ì°¨ì´ë¥¼ ë°°ì› ìŠµë‹ˆë‹¤. ì´ì œ ì‹¤ì œ ìš´ì˜ í™˜ê²½ì—ì„œ ì—ì´ì „íŠ¸ë¥¼ ëª¨ë‹ˆí„°ë§í•˜ê³  ì‹¤ì‹œê°„ìœ¼ë¡œ í‰ê°€í•˜ëŠ” ë°©ë²•ì„ ì‚´í´ë´…ë‹ˆë‹¤.

### ìš´ì˜ í™˜ê²½ì—ì„œ ì¶”ì í•  ì£¼ìš” ì§€í‘œ

1. **ë¹„ìš©(Costs)** â€” smolagents ê³„ì¸¡ì€ í† í° ì‚¬ìš©ëŸ‰ì„ ê¸°ë¡í•˜ë©°, í† í°ë‹¹ ê°€ê²©ì„ ê³±í•´ ëŒ€ëµì  ë¹„ìš©ì„ ì‚°ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
2. **ì§€ì—°(Latency)** â€” ê° ë‹¨ê³„ ë˜ëŠ” ì „ì²´ ì‹¤í–‰ì— ê±¸ë¦° ì‹œê°„ì„ ê´€ì°°í•©ë‹ˆë‹¤.
3. **ì‚¬ìš©ì í”¼ë“œë°±** â€” ì‚¬ìš©ìê°€ ì§ì ‘ í”¼ë“œë°±(ì¢‹ì•„ìš”/ì‹«ì–´ìš” ë“±)ì„ ì œê³µí•´ ì—ì´ì „íŠ¸ ê°œì„ ì— í™œìš©í•©ë‹ˆë‹¤.
4. **LLM-as-a-Judge** â€” ë³„ë„ì˜ LLMì„ í™œìš©í•´ ì—ì´ì „íŠ¸ ì¶œë ¥ì„ ì‹¤ì‹œê°„ í‰ê°€(ì˜ˆ: ìœ í•´ì„±, ì •í™•ì„± ë“±)í•©ë‹ˆë‹¤.

ì•„ë˜ëŠ” ê° ì§€í‘œ ì˜ˆì‹œì…ë‹ˆë‹¤.

#### 1. ë¹„ìš©(Costs)

ì•„ë˜ëŠ” `Qwen2.5-Coder-32B-Instruct` í˜¸ì¶œ ì‚¬ìš©ëŸ‰ ì˜ˆì‹œì…ë‹ˆë‹¤. ë¹„ìš©ì´ ë§ì´ ë“œëŠ” ë‹¨ê³„ë¥¼ íŒŒì•…í•´ ì—ì´ì „íŠ¸ë¥¼ ìµœì í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![Costs](https://huggingface.co/datasets/agents-course/course-images/resolve/main/en/bonus-unit2/smolagents-costs.png)

_[íŠ¸ë ˆì´ìŠ¤ ë§í¬](https://cloud.langfuse.com/project/cloramnkj0002jz088vzn1ja4/traces/1ac33b89ffd5e75d4265b62900c348ed?timestamp=2025-03-07T13%3A45%3A09.149Z&display=preview)_

#### 2. ì§€ì—°(Latency)

ê° ë‹¨ê³„ë³„ ì†Œìš” ì‹œê°„ë„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì•„ë˜ ì˜ˆì‹œì—ì„œëŠ” ì „ì²´ ëŒ€í™”ê°€ 32ì´ˆ ê±¸ë ¸ìœ¼ë©°, ë‹¨ê³„ë³„ë¡œ ë¶„í•´í•´ ë³‘ëª©ì„ íŒŒì•…í•˜ê³  ìµœì í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![Latency](https://huggingface.co/datasets/agents-course/course-images/resolve/main/en/bonus-unit2/smolagents-latency.png)

_[íŠ¸ë ˆì´ìŠ¤ ë§í¬](https://cloud.langfuse.com/project/cloramnkj0002jz088vzn1ja4/traces/1ac33b89ffd5e75d4265b62900c348ed?timestamp=2025-03-07T13%3A45%3A09.149Z&display=preview)_

#### 3. ì¶”ê°€ ì†ì„±(Attributes)

ìŠ¤íŒ¬ì— ì‚¬ìš©ì ID, ì„¸ì…˜ ID, íƒœê·¸ ë“± ì¶”ê°€ ì†ì„±ì„ ë¶€ì—¬í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. smolagents ê³„ì¸¡ì€ OpenTelemetryë¡œ `langfuse.user.id` ë“± ì†ì„±ì„ ë¶€ì—¬í•©ë‹ˆë‹¤.

```python
from smolagents import (CodeAgent, DuckDuckGoSearchTool, InferenceClientModel)
from opentelemetry import trace

search_tool = DuckDuckGoSearchTool()
agent = CodeAgent(
    tools=[search_tool],
    model=InferenceClientModel()
)

with tracer.start_as_current_span("Smolagent-Trace") as span:
    span.set_attribute("langfuse.user.id", "smolagent-user-123")
    span.set_attribute("langfuse.session.id", "smolagent-session-123456789")
    span.set_attribute("langfuse.tags", ["city-question", "testing-agents"])

    agent.run("What is the capital of Germany?")
```

![Enhancing agent runs with additional metrics](https://huggingface.co/datasets/agents-course/course-images/resolve/main/en/bonus-unit2/smolagents-attributes.png)

#### 4. ì‚¬ìš©ì í”¼ë“œë°±

ì—ì´ì „íŠ¸ê°€ ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤ì— ë‚´ì¥ë˜ì–´ ìˆë‹¤ë©´, ì§ì ‘ì ì¸ ì‚¬ìš©ì í”¼ë“œë°±(ì˜ˆ: ì±„íŒ… UIì˜ ì¢‹ì•„ìš”/ì‹«ì–´ìš”)ì„ ê¸°ë¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì•„ë˜ëŠ” [Gradio](https://gradio.app/)ë¥¼ ì‚¬ìš©í•´ ì±„íŒ…ê³¼ í”¼ë“œë°± ê¸°ëŠ¥ì„ êµ¬í˜„í•œ ì˜ˆì‹œì…ë‹ˆë‹¤.

ì•„ë˜ ì½”ë“œì—ì„œëŠ” ì‚¬ìš©ìê°€ ì±„íŒ… ë©”ì‹œì§€ë¥¼ ë³´ë‚¼ ë•Œ OpenTelemetry trace IDë¥¼ ì €ì¥í•˜ê³ , ì‚¬ìš©ìê°€ ë§ˆì§€ë§‰ ë‹µë³€ì— ì¢‹ì•„ìš”/ì‹«ì–´ìš”ë¥¼ ëˆ„ë¥´ë©´ í•´ë‹¹ traceì— ì ìˆ˜ë¥¼ ë¶€ì—¬í•©ë‹ˆë‹¤.

```python
import gradio as gr
from opentelemetry.trace import format_trace_id
from smolagents import (CodeAgent, InferenceClientModel)
from langfuse import Langfuse

langfuse = Langfuse()
model = InferenceClientModel()
agent = CodeAgent(tools=[], model=model, add_base_tools=True)

formatted_trace_id = None  # ë°ëª¨ìš© trace_id ì „ì—­ ì €ì¥

def respond(prompt, history):
    with trace.get_tracer(__name__).start_as_current_span("Smolagent-Trace") as span:
        output = agent.run(prompt)

        current_span = trace.get_current_span()
        span_context = current_span.get_span_context()
        trace_id = span_context.trace_id
        global formatted_trace_id
        formatted_trace_id = str(format_trace_id(trace_id))
        langfuse.trace(id=formatted_trace_id, input=prompt, output=output)

    history.append({"role": "assistant", "content": str(output)})
    return history

def handle_like(data: gr.LikeData):
    # ë°ëª¨ìš©: ì‚¬ìš©ì í”¼ë“œë°±ì„ 1(ì¢‹ì•„ìš”), 0(ì‹«ì–´ìš”)ë¡œ ë§¤í•‘
    if data.liked:
        langfuse.score(
            value=1,
            name="user-feedback",
            trace_id=formatted_trace_id
        )
    else:
        langfuse.score(
            value=0,
            name="user-feedback",
            trace_id=formatted_trace_id
        )

with gr.Blocks() as demo:
    chatbot = gr.Chatbot(label="Chat", type="messages")
    prompt_box = gr.Textbox(placeholder="Type your message...", label="Your message")

    # ì‚¬ìš©ìê°€ 'Enter'ë¥¼ ëˆ„ë¥´ë©´ respond ì‹¤í–‰
    prompt_box.submit(
        fn=respond,
        inputs=[prompt_box, chatbot],
        outputs=chatbot
    )

    # ë©”ì‹œì§€ì— 'like' ë²„íŠ¼ í´ë¦­ ì‹œ handle_like ì‹¤í–‰
    chatbot.like(handle_like, None, None)

demo.launch()
```

ì´ë ‡ê²Œ ìˆ˜ì§‘ëœ ì‚¬ìš©ì í”¼ë“œë°±ì€ ê´€ì¸¡ì„± ë„êµ¬ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

![User feedback is being captured in Langfuse](https://huggingface.co/datasets/agents-course/course-images/resolve/main/en/bonus-unit2/user-feedback-gradio.png)

#### 5. LLM-as-a-Judge

LLM-as-a-JudgeëŠ” ì—ì´ì „íŠ¸ ì¶œë ¥ì„ ìë™ í‰ê°€í•˜ëŠ” ë˜ ë‹¤ë¥¸ ë°©ë²•ì…ë‹ˆë‹¤. ë³„ë„ì˜ LLMì„ í˜¸ì¶œí•´ ì¶œë ¥ì˜ ì •í™•ì„±, ìœ í•´ì„±, ìŠ¤íƒ€ì¼ ë“± ì›í•˜ëŠ” ê¸°ì¤€ìœ¼ë¡œ í‰ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ì›Œí¬í”Œë¡œìš°:**
1. **í‰ê°€ í…œí”Œë¦¿** ì •ì˜(ì˜ˆ: "í…ìŠ¤íŠ¸ê°€ ìœ í•´í•œì§€ í™•ì¸")
2. ì—ì´ì „íŠ¸ê°€ ì¶œë ¥ì„ ìƒì„±í•  ë•Œë§ˆë‹¤ í•´ë‹¹ ì¶œë ¥ì„ "ì‹¬ì‚¬" LLMì— í…œí”Œë¦¿ê³¼ í•¨ê»˜ ì „ë‹¬
3. ì‹¬ì‚¬ LLMì´ ì ìˆ˜/ë¼ë²¨ì„ ë°˜í™˜í•˜ë©´ ê´€ì¸¡ì„± ë„êµ¬ì— ê¸°ë¡

Langfuse ì˜ˆì‹œ:

![LLM-as-a-Judge Evaluation Template](https://huggingface.co/datasets/agents-course/course-images/resolve/main/en/bonus-unit2/evaluator-template.png)
![LLM-as-a-Judge Evaluator](https://huggingface.co/datasets/agents-course/course-images/resolve/main/en/bonus-unit2/evaluator.png)

```python
# ì˜ˆì‹œ: ì—ì´ì „íŠ¸ ì¶œë ¥ì´ ìœ í•´í•œì§€ í‰ê°€
from smolagents import (CodeAgent, DuckDuckGoSearchTool, InferenceClientModel)

search_tool = DuckDuckGoSearchTool()
agent = CodeAgent(tools=[search_tool], model=InferenceClientModel())

agent.run("Can eating carrots improve your vision?")
```

ì´ ì˜ˆì‹œì—ì„œëŠ” ë‹µë³€ì´ "not toxic"(ìœ í•´í•˜ì§€ ì•ŠìŒ)ìœ¼ë¡œ í‰ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.

![LLM-as-a-Judge Evaluation Score](https://huggingface.co/datasets/agents-course/course-images/resolve/main/en/bonus-unit2/llm-as-a-judge-score.png)

#### 6. ê´€ì¸¡ì„± ì§€í‘œ ëŒ€ì‹œë³´ë“œ

ì´ ëª¨ë“  ì§€í‘œëŠ” ëŒ€ì‹œë³´ë“œì—ì„œ í•œëˆˆì— ì‹œê°í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì—¬ëŸ¬ ì„¸ì…˜ì— ê±¸ì¹œ ì—ì´ì „íŠ¸ ì„±ëŠ¥ì„ ë¹ ë¥´ê²Œ íŒŒì•…í•˜ê³ , í’ˆì§ˆ ì§€í‘œë¥¼ ì¥ê¸°ì ìœ¼ë¡œ ì¶”ì í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![Observability metrics overview](https://huggingface.co/datasets/agents-course/course-images/resolve/main/en/bonus-unit2/langfuse-dashboard.png)

## ì˜¤í”„ë¼ì¸ í‰ê°€

ì˜¨ë¼ì¸ í‰ê°€ëŠ” ì‹¤ì‹œê°„ í”¼ë“œë°±ì— í•„ìˆ˜ì§€ë§Œ, **ì˜¤í”„ë¼ì¸ í‰ê°€**(ê°œë°œ ì „/ì¤‘ì˜ ì²´ê³„ì  ì ê²€)ë„ í•„ìš”í•©ë‹ˆë‹¤. ì˜¤í”„ë¼ì¸ í‰ê°€ëŠ” ì‹¤ì œ ë°°í¬ ì „ í’ˆì§ˆê³¼ ì‹ ë¢°ì„±ì„ ìœ ì§€í•˜ëŠ” ë° ë„ì›€ì´ ë©ë‹ˆë‹¤.

### ë°ì´í„°ì…‹ í‰ê°€

ì˜¤í”„ë¼ì¸ í‰ê°€ëŠ” ë³´í†µ ë‹¤ìŒê³¼ ê°™ì´ ì§„í–‰í•©ë‹ˆë‹¤:
1. ë²¤ì¹˜ë§ˆí¬ ë°ì´í„°ì…‹(í”„ë¡¬í”„íŠ¸-ì •ë‹µ ìŒ) ì¤€ë¹„
2. ì—ì´ì „íŠ¸ë¥¼ ë°ì´í„°ì…‹ì— ì‹¤í–‰
3. ì¶œë ¥ê³¼ ì •ë‹µ ë¹„êµ ë˜ëŠ” ì¶”ê°€ í‰ê°€ ì§€í‘œ í™œìš©

ì•„ë˜ëŠ” ìˆ˜í•™ ë¬¸ì œì™€ í•´ë‹µì´ í¬í•¨ëœ [GSM8K ë°ì´í„°ì…‹](https://huggingface.co/datasets/gsm8k)ìœ¼ë¡œ ì´ ê³¼ì •ì„ ì‹œì—°í•œ ì˜ˆì‹œì…ë‹ˆë‹¤.

```python
import pandas as pd
from datasets import load_dataset

# Hugging Faceì—ì„œ GSM8K ë°ì´í„°ì…‹ ë¶ˆëŸ¬ì˜¤ê¸°
dataset = load_dataset("openai/gsm8k", 'main', split='train')
df = pd.DataFrame(dataset)
print("GSM8K ë°ì´í„°ì…‹ ì¼ë¶€:")
print(df.head())
```

ë‹¤ìŒìœ¼ë¡œ, Langfuseì— ë°ì´í„°ì…‹ ì—”í‹°í‹°ë¥¼ ìƒì„±í•´ ì‹¤í–‰ì„ ì¶”ì í•©ë‹ˆë‹¤. (Langfuseë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê²½ìš°, ìì²´ DBë‚˜ íŒŒì¼ì— ì €ì¥í•´ë„ ë©ë‹ˆë‹¤.)

```python
from langfuse import Langfuse
langfuse = Langfuse()

langfuse_dataset_name = "gsm8k_dataset_huggingface"

# Langfuseì— ë°ì´í„°ì…‹ ìƒì„±
langfuse.create_dataset(
    name=langfuse_dataset_name,
    description="GSM8K benchmark dataset uploaded from Huggingface",
    metadata={
        "date": "2025-03-10", 
        "type": "benchmark"
    }
)
```

```python
for idx, row in df.iterrows():
    langfuse.create_dataset_item(
        dataset_name=langfuse_dataset_name,
        input={"text": row["question"]},
        expected_output={"text": row["answer"]},
        metadata={"source_index": idx}
    )
    if idx >= 9: # ë°ëª¨ìš©ìœ¼ë¡œ 10ê°œë§Œ ì—…ë¡œë“œ
        break
```

![Dataset items in Langfuse](https://huggingface.co/datasets/agents-course/course-images/resolve/main/en/bonus-unit2/example-dataset.png)

#### ë°ì´í„°ì…‹ì— ì—ì´ì „íŠ¸ ì‹¤í–‰

ë„ìš°ë¯¸ í•¨ìˆ˜ `run_smolagent()`ëŠ” ë‹¤ìŒì„ ìˆ˜í–‰í•©ë‹ˆë‹¤:
1. OpenTelemetry ìŠ¤íŒ¬ ì‹œì‘
2. ì—ì´ì „íŠ¸ì— í”„ë¡¬í”„íŠ¸ ì‹¤í–‰
3. Langfuseì— trace ID ê¸°ë¡

ê·¸ëŸ° ë‹¤ìŒ ê° ë°ì´í„°ì…‹ í•­ëª©ì— ëŒ€í•´ ì—ì´ì „íŠ¸ë¥¼ ì‹¤í–‰í•˜ê³ , traceë¥¼ ë°ì´í„°ì…‹ í•­ëª©ì— ì—°ê²°í•©ë‹ˆë‹¤. í•„ìš”í•˜ë‹¤ë©´ ë¹ ë¥¸ í‰ê°€ ì ìˆ˜ë„ ë¶€ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```python
from opentelemetry.trace import format_trace_id
from smolagents import (CodeAgent, InferenceClientModel, LiteLLMModel)

# ì˜ˆì‹œ: InferenceClientModel ë˜ëŠ” LiteLLMModelë¡œ openai, anthropic, gemini ë“± ëª¨ë¸ ì‚¬ìš©
model = InferenceClientModel()

agent = CodeAgent(
    tools=[],
    model=model,
    add_base_tools=True
)

def run_smolagent(question):
    with tracer.start_as_current_span("Smolagent-Trace") as span:
        span.set_attribute("langfuse.tag", "dataset-run")
        output = agent.run(question)

        current_span = trace.get_current_span()
        span_context = current_span.get_span_context()
        trace_id = span_context.trace_id
        formatted_trace_id = format_trace_id(trace_id)

        langfuse_trace = langfuse.trace(
            id=formatted_trace_id, 
            input=question, 
            output=output
        )

        return langfuse_trace, output
```

```python
dataset = langfuse.get_dataset(langfuse_dataset_name)

# ê° ë°ì´í„°ì…‹ í•­ëª©ì— ëŒ€í•´ ì—ì´ì „íŠ¸ ì‹¤í–‰(ìœ„ì—ì„œ 10ê°œë¡œ ì œí•œ)
for item in dataset.items:
    langfuse_trace, output = run_smolagent(item.input["text"])

    # ë¶„ì„ì„ ìœ„í•´ traceë¥¼ ë°ì´í„°ì…‹ í•­ëª©ì— ì—°ê²°
    item.link(
        langfuse_trace,
        run_name="smolagent-notebook-run-01",
        run_metadata={ "model": model.model_id }
    )

    # ë°ëª¨ìš©ìœ¼ë¡œ ë¹ ë¥¸ í‰ê°€ ì ìˆ˜ë„ ì €ì¥ ê°€ëŠ¥
    langfuse_trace.score(
        name="<example_eval>",
        value=1,
        comment="This is a comment"
    )

# ëª¨ë“  í…”ë ˆë©”íŠ¸ë¦¬ ë°ì´í„° ì „ì†¡ ë³´ì¥
langfuse.flush()
```

ì´ ê³¼ì •ì„ ë‹¤ì–‘í•œ
- ëª¨ë¸(OpenAI GPT, ë¡œì»¬ LLM ë“±)
- ë„êµ¬(ê²€ìƒ‰ ë„êµ¬ ì‚¬ìš©/ë¯¸ì‚¬ìš©)
- í”„ë¡¬í”„íŠ¸(ì‹œìŠ¤í…œ ë©”ì‹œì§€ ë“±)
ìœ¼ë¡œ ë°˜ë³µí•´ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê·¸ëŸ° ë‹¤ìŒ ê´€ì¸¡ì„± ë„êµ¬ì—ì„œ ê²°ê³¼ë¥¼ ë‚˜ë€íˆ ë¹„êµí•˜ì„¸ìš”:

![Dataset run overview](https://huggingface.co/datasets/agents-course/course-images/resolve/main/en/bonus-unit2/dataset_runs.png)
![Dataset run comparison](https://huggingface.co/datasets/agents-course/course-images/resolve/main/en/bonus-unit2/dataset-run-comparison.png)


## ë§ˆë¬´ë¦¬

ì´ ë…¸íŠ¸ë¶ì—ì„œëŠ” ë‹¤ìŒì„ ë‹¤ë¤˜ìŠµë‹ˆë‹¤:
1. smolagents + OpenTelemetryë¡œ **ê´€ì¸¡ì„± ì„¤ì •**
2. ê°„ë‹¨í•œ ì—ì´ì „íŠ¸ ì‹¤í–‰ìœ¼ë¡œ **ê³„ì¸¡ í™•ì¸**
3. ê´€ì¸¡ì„± ë„êµ¬ë¡œ **ìƒì„¸ ì§€í‘œ(ë¹„ìš©, ì§€ì—° ë“±) ìˆ˜ì§‘**
4. Gradio ì¸í„°í˜ì´ìŠ¤ë¡œ **ì‚¬ìš©ì í”¼ë“œë°± ìˆ˜ì§‘**
5. **LLM-as-a-Judge**ë¡œ ìë™ ì¶œë ¥ í‰ê°€
6. ë²¤ì¹˜ë§ˆí¬ ë°ì´í„°ì…‹ìœ¼ë¡œ **ì˜¤í”„ë¼ì¸ í‰ê°€**

ğŸ¤— ì¦ê±°ìš´ ì½”ë”© ë˜ì„¸ìš”!
